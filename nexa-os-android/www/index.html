<!DOCTYPE html> 
 <html lang="es"> 
 <head> 
   <meta charset="UTF-8" /> 
   <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
   <title>NEURONEX PULSE | NEXA Ai.Dev</title> 
   <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script> 
   <style> 
     * { margin: 0; padding: 0; box-sizing: border-box; } 
     body { 
       background: #000; 
       color: #00f3ff; 
       font-family: 'Orbitron', 'Exo 2', sans-serif; 
       overflow: hidden; 
       height: 100vh; 
       position: relative; 
     } 
     #neural-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; } 
     #logo-3d { 
       position: absolute; 
       top: 20px; 
       left: 20px; 
       width: 70px; 
       height: 70px; 
       background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwIiB5MT0iMCIgeDI9IjEiIHkyPSIxIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMDBmM2ZmIi8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZmYwMGM4Ii8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHBhdGggZD0iTTMwLDI1IEw3MCwyNSBMNTAsNzAgWiIgZmlsbD0idXJsKCNnKSIgb3BhY2l0eT0iMC45NSIvPjwvc3ZnPg==') no-repeat center; 
       background-size: contain; 
       filter: drop-shadow(0 0 12px rgba(0,243,255,0.8)); 
       animation: float 8s infinite ease-in-out; 
       z-index: 10; 
     } 
     @keyframes float { 
       0%,100% { transform: translateY(0) rotateZ(0deg); } 
       50% { transform: translateY(-12px) rotateZ(2deg); } 
     } 
     #cosmic-eye { 
       position: absolute; 
       top: 50%; 
       left: 50%; 
       transform: translate(-50%, -50%); 
       width: 220px; 
       height: 220px; 
       border: 2px solid #ff00c8; 
       border-radius: 50%; 
       background: radial-gradient(circle, rgba(0,243,255,0.1) 0%, transparent 70%); 
       box-shadow: 0 0 40px rgba(0,243,255,0.4); 
       z-index: 5; 
       animation: pulse 4s infinite; 
     } 
     @keyframes pulse { 
       0%,100% { box-shadow: 0 0 40px rgba(0,243,255,0.4); } 
       50% { box-shadow: 0 0 80px rgba(255,0,200,0.7); } 
     } 
     .blink { animation: blink 3s infinite; } 
     @keyframes blink { 0%,45%,55%,100% { opacity: 1; } 50% { opacity: 0.2; } } 
      
     #content { 
       position: absolute; 
       bottom: 80px; 
       left: 50%; 
       transform: translateX(-50%); 
       text-align: center; 
       width: 90%; 
       max-width: 800px; 
       z-index: 6; 
       font-size: 16px; 
       line-height: 1.7; 
     } 
     .glitch { animation: glitch 2s infinite; } 
     @keyframes glitch { 
       0% { text-shadow: 0 0 5px #00f3ff; } 
       2% { text-shadow: -2px 0 #ff00c8, 2px 0 #00f3ff; } 
       4%,100% { text-shadow: 0 0 5px #00f3ff; } 
     } 
     .source { font-size: 12px; color: #ff00c8; margin-top: 6px; } 
     #footer { 
       position: absolute; 
       bottom: 20px; 
       width: 100%; 
       text-align: center; 
       font-size: 12px; 
       color: #555; 
       z-index: 10; 
     } 
     .status {  
       display: inline-block; 
       width: 8px; 
       height: 8px; 
       border-radius: 50%; 
       margin-right: 6px; 
     } 
     .online { background: #00ff88; box-shadow: 0 0 5px #00ff88; } 
     .offline { background: #ff3366; box-shadow: 0 0 5px #ff3366; } 
     .simulated { background: #00f3ff; box-shadow: 0 0 5px #00f3ff; }
     .cached { background: #ffaa00; box-shadow: 0 0 5px #ffaa00; }
   </style> 
   <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Exo+2:wght@400;600&display=swap" rel="stylesheet"> 
 </head> 
 <body> 
   <div id="neural-canvas"></div> 
   <div id="logo-3d"></div> 
   <div id="cosmic-eye" class="blink"></div> 
    
   <div id="content"> 
     <h1 class="glitch">NEURONEX PULSE</h1> 
     <div id="qwen-output">Iniciando enlace neuronal...</div> 
     <div id="news-output">Escaneando red global...</div> 
     <div id="sovereign-output">Sovereign-RAG: Verificando...</div> 
   </div> 
  
   <div id="footer"> 
     NEXA Ai.Dev ‚Ä¢ OFFLINE-FIRST ‚Ä¢  
     <span class="status simulated" id="qwen-status"></span>Qwen  
     <span class="status simulated" id="news-status"></span>News  
     <span class="status simulated" id="sovereign-status"></span>RAG 
   </div> 
  
   <script> 
     // === CONFIGURACI√ìN === 
     const CONFIG = { 
       NEWS_API_KEY: '', // Dejar vac√≠o para usar Cache/Fallback
       OPENROUTER_API_KEY: '', // Dejar vac√≠o para usar Cache/Fallback
       SOVEREIGN_RAG_URL: 'http://localhost:8080/rag', 
       QUERY: "¬øQu√© es lo √∫ltimo que la humanidad est√° a punto de descubrir en tecnolog√≠a?" 
     }; 
  
     // === MOCK DATA (ULTIMO RECURSO) ===
     const MOCK_DATA = {
        qwen: "La singularidad no es un punto en el tiempo, es un estado de la red.",
        news: "NEXA OS despliega nodos aut√≥nomos en √≥rbita baja.",
        rag: "Modo soberano activo. Inicia Sovereign-RAG para insights en tiempo real."
     };

     function speak(text) { 
       if ('speechSynthesis' in window) { 
         const msg = new SpeechSynthesisUtterance(text); 
         msg.lang = 'es-ES'; 
         msg.rate = 0.9; 
         speechSynthesis.speak(msg); 
       } 
     } 

     // === GESTI√ìN DE CACH√â ===
     function loadFromCache(key, elementId, statusId, prefix) {
        const cached = localStorage.getItem(key);
        if (cached) {
            document.getElementById(elementId).innerHTML = `<strong>${prefix} (Cach√©):</strong> ${cached}<div class="source">Memoria Local</div>`;
            document.getElementById(statusId).className = 'status cached';
            return true;
        }
        return false;
     }

     function saveToCache(key, value) {
        localStorage.setItem(key, value);
     }
  
     // === 1. SOVEREIGN-RAG (PRIORIDAD ALTA) === 
     async function fetchSovereignRAG() { 
       try { 
         const response = await fetch(CONFIG.SOVEREIGN_RAG_URL, { 
           method: 'POST', 
           headers: { 'Content-Type': 'application/json' }, 
           body: JSON.stringify({ query: "Resumen de amenazas" }) 
         }); 
          
         if (response.ok) { 
           const data = await response.json(); 
           const result = data.insight || data.result;
           document.getElementById('sovereign-output').innerHTML =  
             `<strong>üõ°Ô∏è Sovereign-RAG:</strong> ${result}<div class="source">Motor Local: Online</div>`; 
           document.getElementById('sovereign-status').className = 'status online'; 
           saveToCache('nexa_rag_cache', result);
         } else { throw new Error('RAG offline'); } 
       } catch (err) { 
         // Fallback Offline
         if (!loadFromCache('nexa_rag_cache', 'sovereign-output', 'sovereign-status', 'üõ°Ô∏è Sovereign-RAG')) {
             document.getElementById('sovereign-output').innerHTML =  
               `<strong>üõ°Ô∏è Sovereign-RAG:</strong> ${MOCK_DATA.rag}<div class="source">Sistema Local</div>`; 
             document.getElementById('sovereign-status').className = 'status simulated'; 
         }
       } 
     } 

     // === 2. QWEN (SEGUNDO PLANO) === 
     async function fetchQwenResponse() { 
       // Intentar cargar cach√© primero para velocidad inmediata
       loadFromCache('nexa_qwen_cache', 'qwen-output', 'qwen-status', 'üß† Qwen');

       try { 
         if (!CONFIG.OPENROUTER_API_KEY) throw new Error("No Key");
         
         const response = await fetch('https://openrouter.ai/api/v1/chat/completions', { 
           method: 'POST', 
           headers: { 
             'Content-Type': 'application/json', 
             'Authorization': `Bearer ${CONFIG.OPENROUTER_API_KEY}`, 
             'HTTP-Referer': 'http://nexa-ai.dev', 
             'X-Title': 'NEURONEX PULSE' 
           }, 
           body: JSON.stringify({ 
             model: "qwen/qwen-110b-chat", 
             messages: [{ role: "user", content: CONFIG.QUERY }] 
           }) 
         }); 
          
         if (response.ok) { 
           const data = await response.json(); 
           const answer = data.choices[0].message.content.trim(); 
           document.getElementById('qwen-output').innerHTML =  
             `<strong>üß† Qwen Insight:</strong> ${answer}<div class="source">Fuente: Qwen-110B (OpenRouter)</div>`; 
           document.getElementById('qwen-status').className = 'status online'; 
           saveToCache('nexa_qwen_cache', answer);
           speak("Actualizaci√≥n de inteligencia recibida."); 
         } else { throw new Error('API Error'); } 
       } catch (err) { 
         if (!localStorage.getItem('nexa_qwen_cache')) {
             document.getElementById('qwen-output').innerHTML =  
               `<strong>üß† Qwen (Simulado):</strong> ${MOCK_DATA.qwen}<div class="source">Modo Offline</div>`; 
             document.getElementById('qwen-status').className = 'status simulated'; 
         }
       } 
     } 
  
     // === 3. NOTICIAS (SEGUNDO PLANO) === 
     async function fetchTechNews() { 
       loadFromCache('nexa_news_cache', 'news-output', 'news-status', 'üì∞ Noticias');

       try { 
         if (!CONFIG.NEWS_API_KEY) throw new Error("No Key");

         const response = await fetch( 
           `https://newsapi.org/v2/top-headlines?category=technology&language=es&pageSize=1&apiKey=${CONFIG.NEWS_API_KEY}` 
         ); 
         const data = await response.json(); 
         if (data.articles && data.articles.length > 0) { 
           const article = data.articles[0]; 
           document.getElementById('news-output').innerHTML =  
             `<strong>üì∞ √öltima noticia:</strong> ${article.title}<div class="source">Fuente: ${article.source.name}</div>`; 
           document.getElementById('news-status').className = 'status online'; 
           saveToCache('nexa_news_cache', article.title);
         } else { throw new Error('No news'); } 
       } catch (err) { 
         if (!localStorage.getItem('nexa_news_cache')) {
             document.getElementById('news-output').innerHTML =  
               `<strong>üì∞ Noticias (Simuladas):</strong> ${MOCK_DATA.news}<div class="source">Fuente: NEXA Network (Offline)</div>`; 
             document.getElementById('news-status').className = 'status simulated'; 
         }
       } 
     } 
  
     // === ANIMACI√ìN NEURONAL 3D === 
     let scene, camera, renderer, particles; 
     function initNeuralField() { 
       scene = new THREE.Scene(); 
       camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000); 
       camera.position.z = 300; 
  
       const geometry = new THREE.BufferGeometry(); 
       const vertices = []; 
       const colors = []; 
       const particleCount = 4000; 
       for (let i = 0; i < particleCount; i++) { 
         vertices.push((Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000); 
         colors.push(0, 0.9, 1); 
       } 
       geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3)); 
       geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3)); 
       const material = new THREE.PointsMaterial({ size: 2, vertexColors: true, transparent: true, opacity: 0.6 }); 
       particles = new THREE.Points(geometry, material); 
       scene.add(particles); 
  
       renderer = new THREE.WebGLRenderer({ alpha: true }); 
       renderer.setSize(window.innerWidth, window.innerHeight); 
       renderer.setPixelRatio(window.devicePixelRatio); 
       document.getElementById('neural-canvas').appendChild(renderer.domElement); 
       animate(); 
     } 
     function animate() { 
       requestAnimationFrame(animate); 
       particles.rotation.y += 0.0003; 
       renderer.render(scene, camera); 
     } 
     window.addEventListener('resize', () => { 
       camera.aspect = window.innerWidth / window.innerHeight; 
       camera.updateProjectionMatrix(); 
       renderer.setSize(window.innerWidth, window.innerHeight); 
     }); 
  
     // === INICIO === 
     document.addEventListener('DOMContentLoaded', () => { 
       speak("NEXA OS iniciado. Verificando soberan√≠a de datos."); 
       initNeuralField(); 
        
       // 1. Primero: carga siempre desde Sovereign-RAG 
       fetchSovereignRAG().then(() => {
           console.log("Modo Soberano Activo");
       }).catch(() => {
           console.log("Sovereign-RAG no disponible. Usando cach√©/simulaci√≥n.");
           // El fallback ya se maneja dentro de fetchSovereignRAG con loadFromCache
       });

       // 2. Luego (opcional): intenta Qwen y News solo si hay claves 
       if (CONFIG.OPENROUTER_API_KEY && CONFIG.NEWS_API_KEY) { 
           setTimeout(() => { 
               fetchQwenResponse(); 
               fetchTechNews(); 
           }, 2000); 
       } else {
           console.log("Modo Offline/Sin Claves: Usando datos simulados o cach√©.");
           // Forzar carga de cach√© o simulaci√≥n si no hay claves
           fetchQwenResponse(); 
           fetchTechNews();
       }
        
       setInterval(() => { 
           if (CONFIG.NEWS_API_KEY) fetchTechNews(); 
       }, 60000); 
     }); 
   </script> 
 </body> 
 </html>